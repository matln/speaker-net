# speaker-net

SpeakerNet is a framework that implements various speaker embedding models using PyTorch.

## Installation

* Clone this repo

    ```
    https://github.com/matln/speaker-net.git
    ```
* Create conda env
    ```
    conda env create -f environment.yml
    conda activate speakernet
    ```

## Supports

* Front-end
    - [X] online feature extracting, online VAD, online augmentation
    - [x] online kaldifeat
* Model
    - [x] ECAPA-TDNN
    - [x] ResNet
    - [x] RepVGG
* Loss Function
    - [x] AM-softmax
    - [x] AAM-softmax
    - [x] softmax + label-smoothing
    - [x] subcenter + inter-topk
* Training Strategy
    - [x] Fully resumed training from any checkpoint
* Back-end
    - [x] large margin finetuning
    - [x] submean
    - [x] AS-norm
    - [x] QMF
    - [x] cosine similarity

## Results

EER | min-DCF (0.01)

ResNet34-c32 (Params: 6.6M)

| Model | vox1-O | vox1-O-clean | vox1-E | vox1-E-clean | vox1-H | vox1-H-clean | voxsrc2021-val | voxsrc2022-dev |
|:------|:------:|:------------:|:------------:|:------------:|:------------:|:------------:|:------------:|:------------:|
| AM-softmax                  | 1.087 │ 0.0988 |  0.941 │ 0.0960 | 1.172 │ 0.1121 |  1.035 │ 0.1098 | 1.942 │ 0.1757 |  1.804 │ 0.1736 | 3.013 │ 0.2667 | 2.489 │ 0.3070 |
| + large marign finetuning   | 0.827 │ 0.0663 |  0.707 │ 0.0636 | 0.985 │ 0.0934 |  0.851 │ 0.0908 | 1.632 │ 0.1544 |  1.488 │ 0.1522 | 2.581 │ 0.2115 | 1.949 │ 0.2129 |
| +++ AS-norm                 | 0.790 │ 0.0652 |  0.649 │ 0.0624 | 0.945 │ 0.0874 |  0.809 │ 0.0850 | 1.531 │ 0.1359 |  1.398 │ 0.1337 | 2.414 │ 0.2029 | 1.869 │ 0.2533 |
| ++++ QMF                    | 0.716 │ 0.0629 |  0.569 │ 0.0601 | 0.878 │ 0.0838 |  0.746 │ 0.0815 | 1.432 │ 0.1261 |  1.291 │ 0.1239 | 2.179 │ 0.1975 | 1.760 │ 0.2527 |


ResNet34-c64 (Params: 26.5M)

| Model                       |    vox1-O      |   vox1-O-clean  |    vox1-E      |   vox1-E-clean  |    vox1-H      |   vox1-H-clean  | voxsrc2021-val | voxsrc2022-dev |
|:------|:------:|:------------:|:------------:|:------------:|:------------:|:------------:|:------------:|:------------:|
| AM-softmax                  | 0.779 │ 0.0518 |  0.644 │ 0.0491 | 0.948 │ 0.0912 |  0.820 │ 0.0889 | 1.595 │ 0.1419 |  1.452 │ 0.1397 | 2.453 │ 0.2351 | 2.018 │ 0.2191 |
| + large margin finetuning   | 0.636 │ 0.0466 |  0.527 │ 0.0439 | 0.852 │ 0.0778 |  0.716 │ 0.0751 | 1.457 │ 0.1332 |  1.312 │ 0.1310 | 2.376 │ 0.2137 | 1.762 │ 0.1793 |
| ++ AS-norm                  | 0.626 │ 0.0409 |  0.484 │ 0.0382 | 0.819 │ 0.0686 |  0.679 │ 0.0662 | 1.354 │ 0.1150 |  1.207 │ 0.1128 | 2.254 │ 0.1864 | 1.691 │ 0.2070 |
| +++ QMF                     | 0.536 │ 0.0440 |  0.431 │ 0.0412 | 0.782 │ 0.0686 |  0.640 │ 0.0663 | 1.249 │ 0.1117 |  1.108 │ 0.1095 | 2.025 │ 0.1818 | 1.614 │ 0.2211 |


ECAPA-TDNN-c512 (Params: 6.2M)

| Model | vox1-O | vox1-O-clean | vox1-E | vox1-E-clean | vox1-H | vox1-H-clean | voxsrc2021-val | voxsrc2022-dev |
|:------|:------:|:------------:|:------------:|:------------:|:------------:|:------------:|:------------:|:------------:|
| AM-softmax                  | 1.156 │ 0.1170 |  1.015 │ 0.1142 | 1.326 │ 0.1289 |  1.202 │ 0.1267 | 2.293 │ 0.2118 |  2.163 │ 0.2099 | 4.362 │ 0.3281 | 2.950 │ 0.3110 |
| + large margin finetuning   | 0.944 │ 0.0785 |  0.803 │ 0.0757 | 1.128 │ 0.1098 |  1.000 │ 0.1070 | 1.961 │ 0.1891 |  1.828 │ 0.1871 | 3.480 │ 0.2965 | 2.311 │ 0.2435 |
| ++ AS-norm                  | 0.917 │ 0.0767 |  0.761 │ 0.0738 | 1.070 │ 0.1050 |  0.943 │ 0.1024 | 1.845 │ 0.1745 |  1.717 │ 0.1725 | 3.297 │ 0.2626 | 2.258 │ 0.2471 |
| +++ QMF                     | 0.827 │ 0.0727 |  0.702 │ 0.0699 | 0.992 │ 0.0961 |  0.859 │ 0.0935 | 1.697 │ 0.1671 |  1.565 │ 0.1650 | 3.026 │ 0.2470 | 2.174 │ 0.2563 |


ECAPA-TDNN-c1024 (Params: 23.5M)

| Model | vox1-O | vox1-O-clean | vox1-E | vox1-E-clean | vox1-H | vox1-H-clean | voxsrc2021-val | voxsrc2022-dev |
|:------|:------:|:------------:|:------------:|:------------:|:------------:|:------------:|:------------:|:------------:|
| AM-softmax                  | 0.928 │ 0.0995 |  0.798 │ 0.0967 | 1.130 │ 0.1138 |  1.005 │ 0.1115 | 1.997 │ 0.1877 |  1.861 │ 0.1856 | 3.754 │ 0.3114 | 2.452 │ 0.2740 |
| + AS-norm                   | 0.880 │ 0.1073 |  0.755 │ 0.1046 | 1.086 │ 0.1048 |  0.954 │ 0.1025 | 1.907 │ 0.1790 |  1.775 │ 0.1769 | 3.577 │ 0.2876 | 2.362 │ 0.2848 |
| ++ QMF                      | 0.864 │ 0.1037 |  0.755 │ 0.1009 | 1.029 │ 0.1035 |  0.901 │ 0.1013 | 1.792 │ 0.1779 |  1.662 │ 0.1758 | 3.450 │ 0.2837 | 2.356 │ 0.3136 |
| + large marign finetuning   | 0.827 │ 0.0954 |  0.670 │ 0.0926 | 1.026 │ 0.1014 |  0.891 │ 0.0990 | 1.829 │ 0.1780 |  1.700 │ 0.1759 | 3.463 │ 0.2880 | 2.148 │ 0.2382 |
| ++ AS-norm                  | 0.779 │ 0.0942 |  0.643 │ 0.0914 | 0.992 │ 0.0928 |  0.858 │ 0.0903 | 1.748 │ 0.1612 |  1.615 │ 0.1591 | 3.300 │ 0.2782 | 2.075 │ 0.2432 |
| +++ QMF                     | 0.790 │ 0.1006 |  0.654 │ 0.0978 | 0.961 │ 0.0918 |  0.820 │ 0.0894 | 1.627 │ 0.1560 |  1.486 │ 0.1539 | 3.187 │ 0.2772 | 2.012 │ 0.2620 |


RepVGG-B1 (Params: 27.3M)
| Model | vox1-O | vox1-O-clean | vox1-E | vox1-E-clean | vox1-H | vox1-H-clean | voxsrc2021-val | voxsrc2022-dev |
|:------|:------:|:------------:|:------------:|:------------:|:------------:|:------------:|:------------:|:------------:|
| AM-softmax                  | 0.705 │ 0.0563 |  0.590 │ 0.0536 | 0.906 │ 0.0807 |  0.773 │ 0.0783 | 1.519 │ 0.1374 |  1.378 │ 0.1352 | 2.389 │ 0.2066 | 1.997 │ 0.2341 |
| + large marign finetuning   | 0.610 │ 0.0514 |  0.468 │ 0.0487 | 0.825 │ 0.0741 |  0.683 │ 0.0718 | 1.375 │ 0.1242 |  1.235 │ 0.1220 | 2.159 │ 0.1793 | 1.705 │ 0.1883 |
| ++ AS-norm                  | 0.546 │ 0.0548 |  0.420 │ 0.0521 | 0.786 │ 0.0684 |  0.643 │ 0.0660 | 1.271 │ 0.1065 |  1.129 │ 0.1042 | 2.045 │ 0.1584 | 1.603 │ 0.2138 |
| +++ QMF                     | 0.509 │ 0.0519 |  0.378 │ 0.0491 | 0.753 │ 0.0649 |  0.605 │ 0.0625 | 1.182 │ 0.1016 |  1.038 │ 0.0993 | 1.869 │ 0.1528 | 1.549 │ 0.2236 |


## Reference

* [WeSpeaker](https://github.com/wenet-e2e/wespeaker)
* [ASV-subtools](https://github.com/Snowdar/asv-subtools)
* [speechbrain](https://github.com/speechbrain/speechbrain)
